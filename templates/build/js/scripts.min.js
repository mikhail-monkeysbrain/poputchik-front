"use strict";function _calendar(){var o=[];$(".dropDown").select2(),$("select.dropDown").change(function(){o=$(this).val().split(","),$(".datepicker, .time-select, .sheme--container, .calendar--form").slideUp(),$(".datepicker").datepicker("refresh"),$(".datepicker").slideDown()}),$(".datepicker").datepicker({numberOfMonths:3,language:"ru",minDate:0,beforeShowDay:function(e){for(var t=e.getMonth(),i=e.getDate(),n=e.getFullYear(),a=0;a<o.length;a++)if(-1!==$.inArray(n+"-"+(t+1)+"-"+i,o))return[!0,"ui-state-active__n1",""];return[!0]},onSelect:function(e,t){$(".time-select, .sheme--container, .calendar--form").slideUp(),$(".place").removeClass("place__selected"),$(".time-select").slideDown()}})}function _selectPlace(){$(".time-select--label").click(function(){$(".calendar--form").slideUp(),$(".sheme--container").slideDown(),$(".place").removeClass("place__selected")}),$(".place").click(function(){$(this).hasClass("place__booking")||($(this).toggleClass("place__selected"),0!==$(".place__selected").length?$(".calendar--form").slideDown():$(".calendar--form").slideUp())})}function _mobileMenu(){$(".burger").click(function(){$(".header--nav, .header--login, .header--nav--menu").toggleClass("header__open--nav"),$(this).toggleClass("burger__open")})}function previewFile(){var e=document.querySelector(".avatar"),t=document.querySelector("input[type=file]").files[0],i=new FileReader;i.onloadend=function(){e.src=i.result},t?i.readAsDataURL(t):e.src=""}function _editProfile(){$(".avatar--wrapper").click(function(){$(".avatar--download").trigger("click")}),$(".avatar--download").change(function(e){previewFile()})}function _editTrip(){$(".trip--btn, .trip--save").click(function(){$(".trip__container .edit__container").slideToggle()})}app.utils.getData=null,app.utils.getScrollPosition=function(){return void 0!==window.scrollY?window.scrollY:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:0},app.utils.okonchanie=function(e,t,i,n){var a=parseInt(e)!==parseFloat(e);return 1<(e+="").length&&"1"===+e.substr(e.length-2,1)||4<+e.substr(e.length-1,1)&&+e.substr(e.length-1,1)<10&&!a?n:"1"!==e.substr(e.length-1,1)||a?i:t},app.utils.isIPhone=function(){return/iPhone|iPod/i.test(navigator.userAgent)},app.utils.parseUrlQuery=function(e){var t=e&&e.indexOf("?"),i={},n=void 0,a=void 0,o=void 0;if(e=e?-1!==t?e.substr(t+1):null:location.search&&location.search.substr(1))for(o=e.split("&"),n=0;n<o.length;n++)i[(a=o[n].split("="))[0]]=a[1];return i},app.utils.insertParam=function(e,t){e=encodeURI(e),t=encodeURI(t);for(var i=document.location.search.substr(1).split("&"),n=i.length,a=void 0;n--;)if((a=i[n].split("="))[0]===e){a[1]=t,i[n]=a.join("=");break}n<0&&(i[i.length]=[e,t].join("="));var o=[];return _.each(i,function(e){""!==e&&o.push(e)}),"?"+o.join("&")},app.utils.insertParam2=function(e,t,i){return t=encodeURI(t),i=encodeURI(i),-1!==e.indexOf("?")?e+="&"+[t,i].join("="):e+="?"+[t,i].join("="),e},app.utils.scrollWidth=function(){var e=document.createElement("div");e.style.overflowY="scroll",e.style.width="50px",e.style.height="50px",e.style.visibility="hidden",document.body.appendChild(e);var t=e.offsetWidth-e.clientWidth;return document.body.removeChild(e),t},app.utils.doubleNumber=function(e){return 1===(e=e.toString()).length?"0"+e:e},app.utils.getDirection={direction:1,lastScrollTop:0,init:function(){var t=this;$(window).scroll(function(){var e=$(window).scrollTop();t.lastScrollTop<=e?t.direction=1:t.direction=-1,t.lastScrollTop=e})}},app.utils.heightLikeWindow=function(e,t){function i(){e.css({height:app.Size.height})}i(),app.on("resize",i,t)},app.utils.sizeLikeWindow=function(t,e){function i(e){t.css(e)}i(app.Size.getSize()),app.on("resize",i,e)},app.utils.getBackgroundImageUrl=function(e){return(e[0].currentStyle||window.getComputedStyle(e[0],!1)).backgroundImage.slice(4,-1).replace(/"/g,"")},app.utils.functionByState=function(e,t){var i,n=void 0;if(_.isString(e))n=_.property(e);else if(_.isFunction(e))n=e;else{if(1!==arguments.length||!_.isObject(e))return _.noop;n=_.property("state"),t=e}return i=function e(){return _.get(e,n(this),_.get(e,"default",_.noop)).apply(this,arguments)},_.each(t,function(t,e){e=e.split(","),_.each(e,function(e){i[e]=t})}),i},app.utils.functionByDevice=function(e){return app.utils.functionByState(_.bind(app.Adaptive.getDeviceType,app.Adaptive),e)},app.components.Loader=function(){function e(){var e=this;this.obj=null,this.isVisible=!1,this.nobg=!1,e.obj=$(".js-loader")}return e.prototype.show=function(){return this.isVisible||(this.nobg&&this.obj.addClass("_nobg"),this.obj.fadeIn(300,function(){}),this.isVisible=!0),this},e.prototype.hide=function(){var e=this;e.isVisible&&(e.obj.stop().fadeOut(1e3).removeClass("_nobg"),e.nobg=!1,e.isVisible=!1)},new e}(),app.components.Multiloader=function(){var e=function(e){this._queue=[],this._callback=null,this._minQueue=e||0;for(var t=this._lastCreatedStack=0;t<this._minQueue;t++)this._queue.push(!1)};return e.prototype.addCallback=function(e,t){this._callback=e,this._scope=t||this},e.prototype.createStack=function(){var e=this,t=e._lastCreatedStack++;return t>this._queue.length-1&&e._queue.push(!1),function(){e._checkStack(t)}},e.prototype._checkStack=function(e){this._queue[e]=!0,_.every(this._queue)&&"function"==typeof this._callback&&this._callback.apply(this._scope)},e}(),app.Size=function(){function e(){var e,t,i=this,n=/iPod|iPad|iPhone/g.test(navigator.userAgent)?"orientationchange load":"resize load";i.width=null,i.height=null,i.orientationChange=(e=i.orientationChange,t=i,function(){return e.apply(t,arguments)}),/android/gi.test(navigator.userAgent)?app.dom.$window.on("load",function(){return setTimeout(i.orientationChange,300)}):app.dom.$window.on(n,i.orientationChange),i.orientationChange()}return e.prototype={orientationChange:function(){var e=this,t=e.height,i=e.width;e.height=Modernizr.touch?window.innerHeight:app.dom.$window.height(),e.width=app.dom.$window.width(),e.width=Math.max(320,e.width),e.height=Math.max(212,e.height),e.width===i&&e.height===t||app.trigger("resize",e.getSize())},getSize:function(){return{width:this.width,height:this.height}}},new e}(),app.ns("app.core").Behavior=Backbone.View.extend({target:"[data-behavior]",initialize:function(e){this.params=e.params||this.defaults},render:function(){app.core.Behavior.__super__.render.apply(this,arguments);var e=this.$(this.target);this.$targets=e,this.initAll(e)},remove:function(){return this.stopListening(),this},initAll:function(e){_.map(e,_.flow($,_.bind(this.initEach,this)))},initEach:function(){},getParams:function(n){var a={},e=this.datas;return _.each(e,function(e,t){var i=n[e];i&&(a[t]=i)}),a},getOption:function(e,t,i){var n=this.params,a=this.defaults,o=[t[e],n[e],a[e]];return i=i||_.negate(_.isUndefined),o=_.map(o,this._getValue),_.find(o,i)},_getValue:function(e){return _.isFunction(e)?e():e}}),function(){var i=app.ns("app.core").View=Backbone.View.extend({subView:{},constructor:function(e){var t=this;(function(e,t){var i=this;_.each(_.pick(_.defaults(e,i),t),function(e,t){i[t]=e,i["_"+t]=_.clone(e)})}).call(t,e=e||{},["ui","gui","tpls","behaviors","subView","subViews"]),t.behaviors=[],t.subView={},t.subViews=[],function(e){this.events=n.call(this,this.events),e.events=n.call(this,e.events)}.call(t,e),i.__super__.constructor.apply(t,[e])},_setElement:function(){var e=this;i.__super__._setElement.apply(e,arguments),function(){var n=this;n.ui=_.reduce(n._ui,function(e,t,i){return e[i]=n.$(t),e},{}),n.gui=_.reduce(n._gui,function(e,t,i){return e[i]=$(t),e},{})}.call(e),function(){this.tpls=_.reduce(this._tpls,function(e,t,i){var n=$(['[id="',t,'"]'].join("")),a=void 0;return a=n.length?n.html():t,e[i]=_.template(a),e},{})}.call(e),t.call(e),function(){var a=this;a.behaviors=[],_.each(a._behaviors,function(e){var t={},i=void 0;if(_.isObject(e)&&(t=e.params,i=e.el,e=e.behavior),e=app.ns("behaviors",app)[e]){var n=new e({el:i||a.$el,params:t});a.behaviors.push(n),n.render()}})}.call(e),a.call(e),function(){var a=this;_.each(a._subViews,function(e){var i=o(e),t=i.el;if(i.SubView=i.subView,t)t=a.$(t),_.each(t,function(e){var t=new i.SubView(_.defaults({el:e},i.options));a.subViews.push(t),t.render()});else{var n=new i.SubView(i.options);a.subViews.push(n),n.render()}}),_.each(a._subView,function(e,t){var i=o(e);i.SubView=i.subView;var n=new i.SubView(i.options);(a.subView[t]=n).render()})}.call(e)},remove:function(){var e=this;e.off(),app.off(null,null,e),function(){_.invoke(this.ui,"off"),this.ui={},_.invoke(this.gui,"off"),this.gui={}}.call(e),function(){this.tpls={}}.call(e),t.call(e),a.call(e),i.__super__.remove.apply(e,arguments)}});function n(e){var n=this;return _.reduce(e,function(e,t,i){return e[function(e){var t=this._ui;return e.replace(/@ui\.[a-zA-Z-_$0-9]*/g,function(e){return t[e.slice(4)]})}.call(n,i)]=t,e},{})}function t(){var i=this;i.behaviors&&(_.each(i.behaviors,function(e,t){app.off(null,null,e),e.remove(),delete i.behaviors[t]}),i.behaviors=[])}function o(e){var t={},i=!1;return _.isObject(e)&&(t=e.options||{},i=e.el||i,e=e.subView),_.isString(e)&&(e=app.subViews[e]),{subView:e,options:t,el:i}}function a(){var i=this;_.each(i.subView,function(e,t){app.off(null,null,e),e.remove(),delete i.subView[t]}),i.subView={},_.each(i.subViews,function(e,t){app.off(null,null,e),e.remove(),delete i.subViews[t]}),i.subViews=[]}}(),app.ns("app.core").Page=app.core.View.extend({loader:null,popup:null,html:null,needGoIn:!1,className:null,pageHolder:null,$bigGallery:null,defLoadAllImages:null,defGoIn:null,defLoaderHide:null,defaultLoaderHide:!0,initialize:function(){this.loader=app.components.loader,app.on("checkGetParams",this.checkGetParams,this)},setProps:function(e,t){this.html=e,this.className=t},render:function(){var e=this;e.defLoadAllImages=$.Deferred(),e.defRenderEnd=$.Deferred(),e.defLoaderHide=$.when(e.defLoadAllImages,e.defRenderEnd),e.defLoaderHide.done(function(){e.goIn(),e.loader.hide()}),app.dom.$window.scrollTop(0),e.html&&(app.GlobalView.$el.append(e.html),e.setElement(app.GlobalView.$el.find('[data-view="'+e.className+'"]')),app.trigger("dom.append"));var t=$("[data-wait-to-load]");if(t.length){var n=new app.components.Multiloader(t.length);n.addCallback(function(){e.defLoadAllImages.resolve()}),t.each(function(e,t){var i=new Image;i.onload=function(){n.createStack()(),$(t).is("img")&&$(t).attr("src",this.src)},$(this).is("img")?i.src=$(this).data("waitToLoad"):i.src=app.utils.getBackgroundImageUrl($(this))})}else e.defLoadAllImages.resolve()},afterRender:function(){this.defRenderEnd.resolve(),this.checkGetParams()},checkGetParams:function(){app.utils.getData||(app.utils.getData=app.utils.parseUrlQuery(window.location.search));var e=void 0;function t(){setTimeout(function(){$("html, body").stop(!0,!0).animate({scrollTop:e.offset().top},500)},310)}app.utils.getData.goto?(e=$(app.utils.getData.goto)).length&&(app.Router._pageCounter?t():$(window).load(t)):(e=$("body"),t())},goOutDefault:function(){var e=this;app.trigger("View.goOutDefaultStart"),setTimeout(function(){e.remove(),app.trigger("View.goOutDefaultEnd")},300)},goIn:function(){this.$el.css({display:"none"}),this.$el.fadeIn(600),app.trigger("View.goIn")},remove:function(){this.trigger("remove"),app.core.Page.__super__.remove.apply(this,arguments)},initGoto:function(){this.$el.on("click","[data-goto]",function(e){e.preventDefault(),$("html, body").animate({scrollTop:$($(this).data("goto")).offset().top-app.Header.$el.find("[data-head-top]").height()},500)})}}),function(){var e="[data-behavior]";(app.ns("app.behaviors").Behavior1=app.core.Behavior.extend({target:e,initEach:function(e){}})).el=e}(),app.ns("app.views").Footer=app.core.View.extend({el:".footer",render:function(){app.views.Footer.__super__.render.apply(this,arguments)}}),app.ns("app.views").GlobalView=Backbone.View.extend({oldViews:[],currentView:null,loader:null,menuItems:null,initialize:function(){this.loader=app.components.loader,this.menuItems=$("[data-head-menu-item]")},selectCurrentMenu:function(e){void 0===e&&(e=0),this.menuItems.removeClass("_active").filter('[data-head-menu-item="'+e+'"]').addClass("_active")},show:function(e){e.render(),this.currentView=e},hide:function(){var e=this;app.once("View.goOutDefaultStart",function(){e.loader.show()}),e.currentView.goOutDefault()},setTitle:function(e){$("title").html(e)}}),app.ns("app.views").Header=app.core.View.extend({el:".header",subView:{},initialize:function(){},render:function(){app.views.Header.__super__.render.apply(this,arguments)}}),$(document).ready(_calendar(),_selectPlace(),_mobileMenu()),app.ns("app.views").Index=app.core.Page.extend({events:{},behaviors:[],subView:{},initialize:function(){app.views.Index.__super__.initialize.apply(this,arguments)},remove:function(){app.views.Index.__super__.remove.apply(this,arguments)},render:function(){app.views.Index.__super__.render.apply(this,arguments),app.views.Index.__super__.afterRender.apply(this,arguments)}}),app.ns("app.views").NotFound=app.core.Page.extend({remove:function(){app.views.NotFound.__super__.remove.apply(this,arguments)},render:function(){app.views.NotFound.__super__.render.apply(this,arguments)}}),app.ns("app.views").Profile=app.core.Page.extend({events:{},behaviors:[],subView:{},initialize:function(){app.views.Profile.__super__.initialize.apply(this,arguments)},remove:function(){app.views.Profile.__super__.remove.apply(this,arguments)},render:function(){app.views.Profile.__super__.render.apply(this,arguments),app.views.Profile.__super__.afterRender.apply(this,arguments)}}),$(document).ready(_editProfile(),_editTrip()),app.ns("app.views").Route=app.core.Page.extend({events:{},behaviors:[],subView:{},initialize:function(){app.views.Route.__super__.initialize.apply(this,arguments)},remove:function(){app.views.Route.__super__.remove.apply(this,arguments)},render:function(){app.views.Route.__super__.render.apply(this,arguments),app.views.Route.__super__.afterRender.apply(this,arguments)}}),function(){var e="[data-subview1]",t=app.ns("app.subViews").subView1=app.core.View.extend({el:e,behaviors:[],subView:{},subViews:[],ui:{},gui:{},events:{},cls:{},data:{},initialize:function(){t.__super__.initialize.apply(this,arguments)},remove:function(){t.__super__.remove.apply(this,arguments)},render:function(){t.__super__.render.apply(this,arguments)}});t.el=e}(),app.modules.Router=Backbone.Router.extend({_pageCounter:0,routes:{"*href":"baseRout"},lastPath:!1,curPath:!1,baseRout:function(){var e=Backbone.history.fragment||"./",t="NotFound",i=void 0;if(this.lastPath=this.curPath,this.curPath=e,this._pageCounter){var n=$.Deferred(),a=$.Deferred();$.when(n,a).done(function(){i.html&&app.GlobalView.show(i)}),app.once("View.goOutDefaultEnd",function(){n.resolve()}),app.once("View.ajax.complete",function(){a.resolve()}),app.GlobalView.hide(),$.get(e,{_:_.now()},function(e){e.jsview&&""!==$.trim(e.jsview)&&((i=new app.views[e.jsview]).setProps(e.body,e.jsview),i.needGoIn=!0,app.trigger("View.ajax.complete"),app.GlobalView.setTitle(e.title),app.GlobalView.selectCurrentMenu(e.sectionId))},"json")}else{var o=$("[data-view]");o.length&&""!==$.trim(o.data("view"))&&(t=app.views[o.data("view")],i=new t({el:o}),app.GlobalView.show(i))}this._pageCounter++},back:function(){var e=this;e.lastPath?(e.lastPath=e.curPath=!1,window.history.back()):(e.lastPath=e.curPath=!1,e.navigate("/",!0))}}),$(function(){app.initialize()}),$(function(){svg4everybody()});